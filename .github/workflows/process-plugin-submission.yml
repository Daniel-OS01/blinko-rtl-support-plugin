name: Process Plugin Submission

on:
  issues:
    types: [opened]

jobs:
  process-submission:
    if: contains(github.event.issue.title, '[Plugin Submission]')
    runs-on: ubuntu-latest
    permissions:
      issues: write

    steps:
      - name: Process Plugin Submission
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          BODY="${{ github.event.issue.body }}"
          
          if [[ $BODY =~ https://github.com/[a-zA-Z0-9_-]+/[a-zA-Z0-9_-]+ ]]; then
            REPO_URL=${BASH_REMATCH[0]}
            REPO_NAME=$(echo $REPO_URL | awk -F'/' '{print $NF}')
            echo "repo_url=$REPO_URL" >> $GITHUB_OUTPUT
            echo "repo_name=$REPO_NAME" >> $GITHUB_OUTPUT
            
            gh issue comment "${{ github.event.issue.number }}" --body "Thank you for your submission!
            
            I've detected the repository URL: $REPO_URL
            
            A maintainer will review your submission and approve it by adding the 'approved' label.
            
            Please ensure your repository:
            - [ ] Has a valid plugin.json file in the main branch
            - [ ] Follows the plugin development guidelines
            - [ ] Has proper documentation"
          else
            gh issue comment "${{ github.event.issue.number }}" --body "Error: Could not find a valid GitHub repository URL in your submission.
            
            Please format your issue with:
            - Title: [Plugin Submission] Your Plugin Name
            - Body: Include your GitHub repository URL (e.g., https://github.com/username/repo)"
            exit 1
          fi
